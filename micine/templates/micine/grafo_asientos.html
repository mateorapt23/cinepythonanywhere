{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Grafo de Asientos - Ticket {{ ticket.id }}</title>
  <link rel="stylesheet" href="{% static 'micine/grafoasientos.css' %}" />
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    /* peque√±os estilos locales para el grafo */
    #grafo-container { width: 100%; max-width: 1100px; margin: 1.8rem auto; background: transparent; }
    .grafo-legend { max-width:1100px; margin: 0.6rem auto; display:flex; gap:1rem; align-items:center; color:#f1f1f1; }
    .legend-item { display:flex; gap:0.6rem; align-items:center; font-weight:700 }
    .legend-sample { width:18px; height:18px; border-radius:6px; display:inline-block; }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="navbar-left"><span class="usuario">üë§ {{ user.username }}</span></div>
    <div class="navbar-center">
      <a href="{% url 'home' %}">Cartelera</a>
      <a href="{% url 'snacks' %}">Snacks</a>
      <a href="{% url 'contacto' %}">Contacto</a>
      <a href="{% url 'tickets_usuario' %}">Tickets</a>
    </div>
    <div class="navbar-right"><a href="{% url 'logout' %}">Cerrar sesi√≥n</a></div>
  </nav>

  <main class="main-container">
    <h1>Grafo de asientos ‚Äî Ticket {{ ticket.id }}</h1>

    <div class="pelicula-info" style="max-width:1100px; margin: 0 auto 1rem auto;">
      <div style="flex:1;">
        <p><strong>Pel√≠cula:</strong> {{ ticket.funcion.pelicula.titulo }}</p>
        <p><strong>Funci√≥n:</strong> {{ ticket.funcion.fecha }} | {{ ticket.funcion.hora }} | <strong>Sala:</strong> {{ ticket.funcion.sala.nombre }}</p>
        <p><strong>Asientos en este ticket:</strong> {{ ticket.asientos_letras|join:", " }} (vendidos)</p>
      </div>
      <div style="display:flex; align-items:center; gap:0.8rem;">
        <a class="btn" href="{% url 'ticket_detalle' ticket.id %}">Volver al ticket</a>
      </div>
    </div>

    <!-- leyenda -->
    <div class="grafo-legend">
      <div class="legend-item"><span class="legend-sample" style="background:#2ecc71"></span> Disponible</div>
      <div class="legend-item"><span class="legend-sample" style="background:#d9534f"></span> Vendido</div>
      <div class="legend-item"><span class="legend-sample" style="background:#ffd700"></span> Tus asientos</div>
    </div>

    <!-- contenedor donde el JS dibujar√° el SVG del grafo -->
    <div id="grafo-container"></div>

    <!-- T√≠tulo para grafo peque√±o -->
    <h2 style="text-align:center; margin-top: 2rem; color: #eee;">Grafo reducido: asientos seleccionados y adyacentes</h2>

    <!-- Contenedor peque√±o para el grafo compacto -->
    <div id="grafo-pequeno-container" style="width: 400px; height: 300px; margin: 0 auto;"></div>

    <div id="grafo-info"></div>

    <!-- Inyectamos los datos como variable JS global -->
    <script>
      window.asientosData = JSON.parse('{{ asientos_json|escapejs }}');
    </script>
    <script defer src="{% static 'micine/grafo_asientos.js' %}"></script>
  </main>
</body>
</html>