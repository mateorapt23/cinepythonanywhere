{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Grafo de Rutas - Ticket {{ ticket.id }}</title>
  <link rel="stylesheet" href="{% static 'micine/graforutas.css' %}" />
  <script src="https://d3js.org/d3.v7.min.js"></script>

</head>
<body>
  <nav class="navbar">
    <div class="navbar-left"><span class="usuario">ðŸ‘¤ {{ user.username }}</span></div>
    <div class="navbar-center">
      <a href="{% url 'home' %}">Cartelera</a>
      <a href="{% url 'snacks' %}">Snacks</a>
      <a href="{% url 'contacto' %}">Contacto</a>
      <a href="{% url 'tickets_usuario' %}">Tickets</a>
    </div>
    <div class="navbar-right"><a href="{% url 'logout' %}">Cerrar sesiÃ³n</a></div>
  </nav>

  <main class="main-container">
    <h1>Grafo de rutas â€” Ticket {{ ticket.id }}</h1>

    <div class="pelicula-info" style="max-width:1100px; margin: 0 auto 1rem auto;">
      <div style="flex:1;">
        <p><strong>PelÃ­cula:</strong> {{ ticket.funcion.pelicula.titulo }}</p>
        <p><strong>FunciÃ³n:</strong> {{ ticket.funcion.fecha }} | {{ ticket.funcion.hora }} | <strong>Sala:</strong> {{ ticket.funcion.sala.nombre }}</p>
        <p><strong>Asientos en este ticket:</strong> {{ ticket.asientos_letras|join:", " }} (vendidos)</p>
      </div>
      <div style="display:flex; align-items:center; gap:0.8rem;">
        <a class="btn" href="{% url 'ticket_detalle' ticket.id %}">Volver al ticket</a>
      </div>
    </div>

    <!-- leyenda -->
    <div class="grafo-legend">
      <div class="legend-item"><span class="legend-sample" style="background:#2ecc71"></span> Disponible</div>
      <div class="legend-item"><span class="legend-sample" style="background:#d9534f"></span> Ocupado</div>
      <div class="legend-item"><span class="legend-sample" style="background:#ffd700"></span> Tus asientos</div>
      <div class="legend-item"><span class="legend-sample" style="background:#3498db"></span> Pantalla</div>
      <div class="legend-item"><span class="legend-sample" style="background:#9b59b6"></span> Puerta de salida</div>
    </div>

    <!-- contenedor grafo grande -->
    <div id="grafo-container"></div>

    <!-- contenedores grafos reducidos -->
    <div class="grafos-reducidos-container">
      <div class="grafo-reducido-box">
        <h3 style="text-align:center; color: #eee;">Camino mas corto a la puerta</h3>
        <div id="grafo-camino-corto" style="width: 300px; height: 250px;"></div>
      </div>
      <div class="grafo-reducido-box">
        <h3 style="text-align:center; color: #eee;">Distancia pantalla - asientos</h3>
        <div id="grafo-pantalla-distancia" style="width: 300px; height: 250px;"></div>
      </div>
      <div class="grafo-reducido-box">
        <h3 style="text-align:center; color: #eee;">Ruta del usuario</h3>
        <div id="grafo-ruta-usuario" style="width: 300px; height: 250px;"></div>
      </div>
    </div>

    <div id="grafo-info"></div>

    <!-- datos inyectados -->
    <script>
      window.rutasData = JSON.parse('{{ rutas_json|escapejs }}');
    </script>
    <script defer src="{% static 'micine/grafo_rutas.js' %}"></script>
  </main>
</body>
</html>